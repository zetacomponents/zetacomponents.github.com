<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html 
	xmlns="http://www.w3.org/1999/xhtml"
	xml:lang="en"
	lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

	<meta name="description" content="Zeta Components - reusable set of high quality PHP components to fasten your development." />
	<meta name="keywords" content="PHP, apache, components, framework, quality" />
	<meta name="author" content="dotxp" />
	<meta name="language" content="en" />
	<meta name="date" content="Wed, 04 Aug 2010 13:07:08 +0200" />
	<meta name="robots" content="all" />

	<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" />
	<meta name="DC.title" content="Cache" />
	<meta name="DC.creator" content="dotxp" />
	<meta name="DC.date" content="Wed, 04 Aug 2010 13:07:08 +0200" />
	<meta name="DC.rights" content="Copyright" />

	<link rel="meta" href="/documentation/trunk/Cache/tutorial.rdf" />
	<link rel="icon" href="/images/favicon.png" type="image/png" />

	<link rel="Stylesheet" type="text/css" href="/styles/screen.css" media="screen" />
	<link rel="Stylesheet" type="text/css" href="/styles/print.css" media="print" />


	<title>Zeta Components - high quality PHP components</title>
</head>
<body>
<div id="wcv">
	<h1>
		<a id="header-png" href="" title="Zeta Components - high quality PHP components">
			Zeta Components - high quality PHP components
		</a>
	</h1>

	<ul class="navigation">
<li >
	<a href="/news.html" title="About">About</a>
	</li>
<li >
	<a href="/community/index.html" title="Community">Community</a>
	</li>
<li class="requested">
	<a href="/documentation/overview.html" title="Documentation">Documentation</a>
	</li>
<li >
	<a href="/download/index.html" title="Download">Download</a>
	</li>
<li >
	<a href="/support.html" title="Support">Support</a>
	</li>

</ul>
<ul class="subnavigation">
<li >
	<a href="/documentation/overview.html" title="Overview">Overview</a>
	</li>
<li >
	<a href="/documentation/install.html" title="Installation">Installation</a>
	</li>

</ul>

	<div class="content">
    <ul class="tabs">
    <li >
	<a href="/documentation/trunk/Cache/tutorial.html" title="Tutorial">Tutorial</a>
	</li>
<li >
	<a href="/documentation/trunk/Cache/phpdoc/classtrees.html" title="API">API</a>
	</li>

</ul>

		<h2>eZ Components - Cache</h2><div class="toc"><h3>Table of Contents</h3><ul><li><p><a href="#introduction">Introduction</a></p></li><li><p><a href="#class-overview">Class overview</a></p></li><li><p><a href="#usage">Usage</a></p><ul><li><p><a href="#terminology">Terminology</a></p></li><li><p><a href="#a-simple-example">A simple example</a></p></li><li><p><a href="#delayed-initialization">Delayed initialization</a></p></li><li><p><a href="#using-multiple-caches">Using multiple caches</a></p></li><li><p><a href="#complex-caching">Complex caching</a></p></li><li><p><a href="#memory-caching">Memory caching</a></p><ul><li><p><a href="#id2">APC</a></p></li><li><p><a href="#id3">Memcache</a></p></li></ul></li><li><p><a href="#hierarchical-caching">Hierarchical caching</a></p><ul><li><p><a href="#a-simple-stack">A simple stack</a></p></li><li><p><a href="#stacks-and-ezccachemanager">Stacks and <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheManager.html'>ezcCacheManager</a></a></p></li><li><p><a href="#stack-meta-data">Stack meta data</a></p></li></ul></li></ul></li><li><p><a href="#more-information">More Information</a></p></li></ul></div><a name="introduction"></a><a name="id4"></a><h3>Introduction</h3><p>The Cache package provides a collection of lightweight classes to cache different kinds of data. It provides a manager class, which takes care of instantiating and reusing caches.</p><a name="class-overview"></a><a name="id5"></a><h3>Class overview</h3><p>This section gives you an overview of the most important classes.</p><dl><dt>ezcCacheManager</dt><dd>This is the optional manager, which is recommended if your application needs to cache different data for different purposes. It allows you to configure all caches in a central place and to retrieve them through <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheManager.html'>ezcCacheManager</a>. The cache manager will store only the configurations by default, only instantiating the cache object when requested.</dd><dt>ezcCacheStorage</dt><dd>This is the base class for all cache storage (the cache classes themselves). All cache classes inherit from this base class.</dd><dt>ezcCacheStack</dt><dd>Using this class, multiple cache storages can be combined using a technique called "hierarchical caching". This works similar to how CPU and file system caches work. For more information please refer to the <a href="#hierarchical-caching">Hierarchical caching</a> section.</dd><dt>ezcCacheStorageFilePlain</dt><dd>Cache objects of this class are capable of storing plain text data on the file system. It utilizes the file_get_contents() and file_put_contents() PHP functions.</dd><dt>ezcCacheStorageFileArray</dt><dd>In contrast to <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStorageFilePlain.html'>ezcCacheStorageFilePlain</a>, objects of this class can store array structures and will keep PHP data types intact. The <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStorageFileArray.html'>ezcCacheStorageFileArray</a> class generates PHP code, which will be stored on the file system. Restoring data from the cache uses the require() construct.</dd><dt>ezcCacheStorageFileEvalArray</dt><dd>Objects of this storage class follow a similar approach to <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStorageFileArray.html'>ezcCacheStorageFileArray</a>; they are also capable of storing array structures. The major difference between both classes is that <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStorageFileEvalArray.html'>ezcCacheStorageFileEvalArray</a> will use PHP's eval() method instead of require() to restore the cached data. As a result, the stored data will not be cached again in PHP accelerators like <a href="http://pecl.php.net/package/APC">APC</a>. This might be desirable if you store large amounts of data at once.</dd><dt>ezcCacheStorageMemcachePlain</dt><dd>Uses the PHP <a href="http://pecl.php.net/package/Memcache">Memcache</a> extension to store cache objects in memory between requests, thus improving speed. The zlib extension is also required by Memcache for on-the-fly compression.</dd><dt>ezcCacheStorageApcPlain</dt><dd>Uses the PHP <a href="http://pecl.php.net/package/APC">APC</a> extension to store cache objects in memory between requests, thus improving speed.</dd><dt>ezcCacheStorageFileApcArray</dt><dd>Uses the PHP <a href="http://pecl.php.net/package/APC">APC</a> extension to store array structures in memory between requests, thus improving speed. It is basically a replacement for <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStorageFileArray.html'>ezcCacheStorageFileArray</a>, if the <a href="http://pecl.php.net/package/APC">APC</a> extension is installed.</dd></dl><a name="usage"></a><a name="id6"></a><h3>Usage</h3><a name="terminology"></a><a name="id7"></a><h4>Terminology</h4><p>A <a href="#cache">cache</a> is identified by a <a href="#cache-identifier">cache identifier</a> and contains a number of <a href="#cache-item">cache item</a> s.</p><dl><dt/><dd>A location that stores <a href="#cache-item">cache item</a> s. A cache is created with <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheManager.html#createCache'>ezcCacheManager::createCache</a>(), preferably at the beginning of your script. A cache with its <a href="#cache-identifier">cache identifier</a> - the first parameter to <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheManager.html#createCache'>ezcCacheManager::createCache</a>() - can only be created once. After it has been created, you can reference it by calling <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheManager.html#getCache'>ezcCacheManager::getCache</a>(), using the corresponding $id as the first parameter.</dd><dt/><dd>An identifier that uniquely identifies a <a href="#cache">cache</a>.</dd><dt/><dd>One single entry stored in a <a href="#cache">cache</a>. Cache items can be stored and retrieved by using the <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStorage.html'>ezcCacheStorage</a> object that is returned by calling <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheManager.html#getCache'>ezcCacheManager::getCache</a>(). Cache items use a <a href="#cache-key">cache key</a> to identify specific entries.</dd><dt/><dd>A string representing a single <a href="#cache-item">cache item</a> in a <a href="#cache">cache</a>.</dd><dt/><dd>Additional information to complement the <a href="#cache-key">cache key</a> in <a href="#cache-item">cache item</a> s.</dd></dl><a name="a-simple-example"></a><a name="id8"></a><h4>A simple example</h4><p>This example shows how to create and use a simple cache with <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheManager.html'>ezcCacheManager</a>:</p><ol class="code">
<li><span style="color: #000000">&lt;?php</span></li>
<li></li>
<li><span style="color: #0000FF">require_once&nbsp;</span><span style="color: #335533">'tutorial_autoload.php'</span><span style="color: #0000FF">;</span></li>
<li></li>
<li><span style="color: #000000">$options&nbsp;</span><span style="color: #0000FF">=&nbsp;array(</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #335533">'ttl'&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF">=&gt;&nbsp;</span><span style="color: #000000">30</span><span style="color: #0000FF">,</span></li>
<li><span style="color: #0000FF">);</span></li>
<li></li>
<li><span style="color: #000000"><a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheManager.html#createCache'>ezcCacheManager::createCache</a></span><span style="color: #0000FF">(&nbsp;</span><span style="color: #335533">'simple'</span><span style="color: #0000FF">,&nbsp;</span><span style="color: #335533">'/tmp/cache/plain'</span><span style="color: #0000FF">,&nbsp;</span><span style="color: #335533">'<a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStorageFilePlain.html'>ezcCacheStorageFilePlain</a>'</span><span style="color: #0000FF">,&nbsp;</span><span style="color: #000000">$options&nbsp;</span><span style="color: #0000FF">);</span></li>
<li></li>
<li><span style="color: #000000">$myId&nbsp;</span><span style="color: #0000FF">=&nbsp;</span><span style="color: #335533">'unique_id_1'</span><span style="color: #0000FF">;</span></li>
<li><span style="color: #000000">$mySecondId&nbsp;</span><span style="color: #0000FF">=&nbsp;</span><span style="color: #335533">'id_2'</span><span style="color: #0000FF">;</span></li>
<li></li>
<li><span style="color: #000000">$cache&nbsp;</span><span style="color: #0000FF">=&nbsp;</span><span style="color: #000000"><a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheManager.html#getCache'>ezcCacheManager::getCache</a></span><span style="color: #0000FF">(&nbsp;</span><span style="color: #335533">'simple'&nbsp;</span><span style="color: #0000FF">);</span></li>
<li></li>
<li><span style="color: #0000FF">if&nbsp;(&nbsp;(&nbsp;</span><span style="color: #000000">$dataOfFirstItem&nbsp;</span><span style="color: #0000FF">=&nbsp;</span><span style="color: #000000">$cache</span><span style="color: #0000FF">-&gt;</span><span style="color: #000000">restore</span><span style="color: #0000FF">(&nbsp;</span><span style="color: #000000">$myId&nbsp;</span><span style="color: #0000FF">)&nbsp;)&nbsp;===&nbsp;</span><span style="color: #000000">false&nbsp;</span><span style="color: #0000FF">)</span></li>
<li><span style="color: #0000FF">{</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000">$dataOfFirstItem&nbsp;</span><span style="color: #0000FF">=&nbsp;</span><span style="color: #335533">"Plain&nbsp;cache&nbsp;stored&nbsp;on&nbsp;"&nbsp;</span><span style="color: #0000FF">.&nbsp;</span><span style="color: #000000">date</span><span style="color: #0000FF">(&nbsp;</span><span style="color: #335533">'Y-m-d,&nbsp;H:i:s'&nbsp;</span><span style="color: #0000FF">);</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000">$cache</span><span style="color: #0000FF">-&gt;</span><span style="color: #000000">store</span><span style="color: #0000FF">(&nbsp;</span><span style="color: #000000">$myId</span><span style="color: #0000FF">,&nbsp;</span><span style="color: #000000">$dataOfFirstItem&nbsp;</span><span style="color: #0000FF">);</span></li>
<li><span style="color: #0000FF">}</span></li>
<li></li>
<li><span style="color: #0000FF">if&nbsp;(&nbsp;(&nbsp;</span><span style="color: #000000">$dataOfSecondItem&nbsp;</span><span style="color: #0000FF">=&nbsp;</span><span style="color: #000000">$cache</span><span style="color: #0000FF">-&gt;</span><span style="color: #000000">restore</span><span style="color: #0000FF">(&nbsp;</span><span style="color: #000000">$mySecondId&nbsp;</span><span style="color: #0000FF">)&nbsp;)&nbsp;===&nbsp;</span><span style="color: #000000">false&nbsp;</span><span style="color: #0000FF">)</span></li>
<li><span style="color: #0000FF">{</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000">$dataOfSecondItem&nbsp;</span><span style="color: #0000FF">=&nbsp;</span><span style="color: #335533">"Plain&nbsp;cache&nbsp;2&nbsp;stored&nbsp;on&nbsp;"&nbsp;</span><span style="color: #0000FF">.&nbsp;</span><span style="color: #000000">date</span><span style="color: #0000FF">(&nbsp;</span><span style="color: #335533">'Y-m-d,&nbsp;H:i:s'&nbsp;</span><span style="color: #0000FF">);</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000">$cache</span><span style="color: #0000FF">-&gt;</span><span style="color: #000000">store</span><span style="color: #0000FF">(&nbsp;</span><span style="color: #000000">$mySecondId</span><span style="color: #0000FF">,&nbsp;</span><span style="color: #000000">$dataOfSecondItem&nbsp;</span><span style="color: #0000FF">);</span></li>
<li><span style="color: #0000FF">}</span></li>
<li></li>
<li><span style="color: #000000">var_dump</span><span style="color: #0000FF">(&nbsp;</span><span style="color: #000000">$dataOfFirstItem</span><span style="color: #0000FF">,&nbsp;</span><span style="color: #000000">$dataOfSecondItem&nbsp;</span><span style="color: #0000FF">);</span></li>
<li></li>
<li><span style="color: #000000">?&gt;</span></li>

</ol><p>Time-to-live is defined as 30 seconds in this case; if left out, the cache will have a lifespan of 24 hours. On line 9, the cache configuration is stored in the cache manager. The created <a href="#cache">cache</a> uses the <a href="#cache-identifier">cache identifier</a> "simple" and will reside in the directory /tmp/cache/plain. (Note: This directory must exist and must be writable!) To store a <a href="#cache-item">cache item</a>, the storage class <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStorageFilePlain.html'>ezcCacheStorageFilePlain</a> will be used.</p><p>Line 11 defines a <a href="#cache-key">cache key</a> for a cache item. The next line defines a second unique <a href="#cache-key">cache key</a> for a second cache item. After that (line 14), the newly-created <a href="#cache">cache</a> object is retrieved from <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheManager.html'>ezcCacheManager</a>. Lines 16 and 22 show how to check for cached data: <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStorage.html#restore'>ezcCacheStorage::restore</a>() will return bool false if no valid cache data is found for the given ID.</p><p>If no valid data is found, the data will be generated and stored in the cache later (lines 17-18 and 24-25). The last line outputs the data, so you can follow how it's cached for 30 seconds by running the example multiple times in a short time frame. After 30 seconds, the cache data will become invalid and will be regenerated.</p><a name="delayed-initialization"></a><a name="id9"></a><h4>Delayed initialization</h4><p>Instead of calling the <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheManager.html#getCache'>ezcCacheManager::getCache</a>() method yourself it is also possible to use delayed initialization. When using this it is not required to configure all the caches first by calling the <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheManager.html#createCache'>ezcCacheManager::createCache</a>() method. Instead it would allow you to configure/create caches on demand, this is called lazy, or delayed initialization. You can find a description how you can use it for your own components and how it works in the <a href="introduction_Base.html#lazy-initialization">ezcBase tutorial</a>. The keyword for the cache component is <em>ezcInitConfigurationManager</em>.</p><ol class="code">
<li><span style="color: #000000">&lt;?php</span></li>
<li></li>
<li><span style="color: #0000FF">require_once&nbsp;</span><span style="color: #335533">'tutorial_autoload.php'</span><span style="color: #0000FF">;</span></li>
<li></li>
<li><span style="color: #0000FF">class&nbsp;</span><span style="color: #000000">customLazyCacheConfiguration&nbsp;</span><span style="color: #0000FF">implements&nbsp;</span><span style="color: #000000">ezcBaseConfigurationInitializer</span></li>
<li><span style="color: #0000FF">{</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;</span><span style="color: #000000">configureObject</span><span style="color: #0000FF">(&nbsp;</span><span style="color: #000000">$id&nbsp;</span><span style="color: #0000FF">)</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;{</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000">$options&nbsp;</span><span style="color: #0000FF">=&nbsp;array(&nbsp;</span><span style="color: #335533">'ttl'&nbsp;</span><span style="color: #0000FF">=&gt;&nbsp;</span><span style="color: #000000">30&nbsp;</span><span style="color: #0000FF">);</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;(&nbsp;</span><span style="color: #000000">$id&nbsp;</span><span style="color: #0000FF">)</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;</span><span style="color: #335533">'simple'</span><span style="color: #0000FF">:</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000"><a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheManager.html#createCache'>ezcCacheManager::createCache</a></span><span style="color: #0000FF">(&nbsp;</span><span style="color: #335533">'simple'</span><span style="color: #0000FF">,&nbsp;</span><span style="color: #335533">'/tmp/cache/plain'</span><span style="color: #0000FF">,&nbsp;</span><span style="color: #335533">'<a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStorageFilePlain.html'>ezcCacheStorageFilePlain</a>'</span><span style="color: #0000FF">,&nbsp;</span><span style="color: #000000">$options&nbsp;</span><span style="color: #0000FF">);</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;}</span></li>
<li><span style="color: #0000FF">}</span></li>
<li></li>
<li><span style="color: #000000"><a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcBaseInit.html#setCallback'>ezcBaseInit::setCallback</a></span><span style="color: #0000FF">(&nbsp;</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #335533">'<a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcInitCacheManager.html'>ezcInitCacheManager</a>'</span><span style="color: #0000FF">,&nbsp;</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #335533">'customLazyCacheConfiguration'</span></li>
<li><span style="color: #0000FF">);</span></li>
<li></li>
<li><span style="color: #000000">$myId&nbsp;</span><span style="color: #0000FF">=&nbsp;</span><span style="color: #335533">'unique_id_1'</span><span style="color: #0000FF">;</span></li>
<li><span style="color: #000000">$mySecondId&nbsp;</span><span style="color: #0000FF">=&nbsp;</span><span style="color: #335533">'id_2'</span><span style="color: #0000FF">;</span></li>
<li></li>
<li><span style="color: #000000">$cache&nbsp;</span><span style="color: #0000FF">=&nbsp;</span><span style="color: #000000"><a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheManager.html#getCache'>ezcCacheManager::getCache</a></span><span style="color: #0000FF">(&nbsp;</span><span style="color: #335533">'simple'&nbsp;</span><span style="color: #0000FF">);</span></li>
<li></li>
<li><span style="color: #0000FF">if&nbsp;(&nbsp;(&nbsp;</span><span style="color: #000000">$dataOfFirstItem&nbsp;</span><span style="color: #0000FF">=&nbsp;</span><span style="color: #000000">$cache</span><span style="color: #0000FF">-&gt;</span><span style="color: #000000">restore</span><span style="color: #0000FF">(&nbsp;</span><span style="color: #000000">$myId&nbsp;</span><span style="color: #0000FF">)&nbsp;)&nbsp;===&nbsp;</span><span style="color: #000000">false&nbsp;</span><span style="color: #0000FF">)</span></li>
<li><span style="color: #0000FF">{</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000">$dataOfFirstItem&nbsp;</span><span style="color: #0000FF">=&nbsp;</span><span style="color: #335533">"Plain&nbsp;cache&nbsp;stored&nbsp;on&nbsp;"&nbsp;</span><span style="color: #0000FF">.&nbsp;</span><span style="color: #000000">date</span><span style="color: #0000FF">(&nbsp;</span><span style="color: #335533">'Y-m-d,&nbsp;H:i:s'&nbsp;</span><span style="color: #0000FF">);</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000">$cache</span><span style="color: #0000FF">-&gt;</span><span style="color: #000000">store</span><span style="color: #0000FF">(&nbsp;</span><span style="color: #000000">$myId</span><span style="color: #0000FF">,&nbsp;</span><span style="color: #000000">$dataOfFirstItem&nbsp;</span><span style="color: #0000FF">);</span></li>
<li><span style="color: #0000FF">}</span></li>
<li></li>
<li><span style="color: #0000FF">if&nbsp;(&nbsp;(&nbsp;</span><span style="color: #000000">$dataOfSecondItem&nbsp;</span><span style="color: #0000FF">=&nbsp;</span><span style="color: #000000">$cache</span><span style="color: #0000FF">-&gt;</span><span style="color: #000000">restore</span><span style="color: #0000FF">(&nbsp;</span><span style="color: #000000">$mySecondId&nbsp;</span><span style="color: #0000FF">)&nbsp;)&nbsp;===&nbsp;</span><span style="color: #000000">false&nbsp;</span><span style="color: #0000FF">)</span></li>
<li><span style="color: #0000FF">{</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000">$dataOfSecondItem&nbsp;</span><span style="color: #0000FF">=&nbsp;</span><span style="color: #335533">"Plain&nbsp;cache&nbsp;2&nbsp;stored&nbsp;on&nbsp;"&nbsp;</span><span style="color: #0000FF">.&nbsp;</span><span style="color: #000000">date</span><span style="color: #0000FF">(&nbsp;</span><span style="color: #335533">'Y-m-d,&nbsp;H:i:s'&nbsp;</span><span style="color: #0000FF">);</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000">$cache</span><span style="color: #0000FF">-&gt;</span><span style="color: #000000">store</span><span style="color: #0000FF">(&nbsp;</span><span style="color: #000000">$mySecondId</span><span style="color: #0000FF">,&nbsp;</span><span style="color: #000000">$dataOfSecondItem&nbsp;</span><span style="color: #0000FF">);</span></li>
<li><span style="color: #0000FF">}</span></li>
<li></li>
<li><span style="color: #000000">var_dump</span><span style="color: #0000FF">(&nbsp;</span><span style="color: #000000">$dataOfFirstItem</span><span style="color: #0000FF">,&nbsp;</span><span style="color: #000000">$dataOfSecondItem&nbsp;</span><span style="color: #0000FF">);</span></li>
<li></li>
<li><span style="color: #000000">?&gt;</span></li>

</ol><p>Differences with the previous example can be seen in lines 5 to 23. In lines 20 to 23 you tell the delayed initialization mechanism to use the customLazyCacheConfiguration as lazy initialization provider for the <em>ezcInitConfigurationManager</em> context. The customLazyCacheConfiguration class implements the configureObject() method that will automatically be called when <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheManager.html#getCache'>ezcCacheManager::getCache</a>() is called with a cache identifier that has not been created yet through <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheManager.html#createCache'>ezcCacheManager::createCache</a>(), as you can see in line 14.</p><a name="using-multiple-caches"></a><a name="id10"></a><h4>Using multiple caches</h4><p>The following example shows how the cache manager deals with multiple caches:</p><ol class="code">
<li><span style="color: #000000">&lt;?php</span></li>
<li></li>
<li><span style="color: #0000FF">require_once&nbsp;</span><span style="color: #335533">'tutorial_autoload.php'</span><span style="color: #0000FF">;</span></li>
<li></li>
<li><span style="color: #000000">$optionsPlain&nbsp;</span><span style="color: #0000FF">=&nbsp;array(</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #335533">'ttl'&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF">=&gt;&nbsp;</span><span style="color: #000000">30</span><span style="color: #0000FF">,</span></li>
<li><span style="color: #0000FF">);</span></li>
<li><span style="color: #000000">$optionsArray&nbsp;</span><span style="color: #0000FF">=&nbsp;array(</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #335533">'ttl'&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF">=&gt;&nbsp;</span><span style="color: #000000">45</span><span style="color: #0000FF">,</span></li>
<li><span style="color: #0000FF">);</span></li>
<li></li>
<li><span style="color: #000000"><a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheManager.html#createCache'>ezcCacheManager::createCache</a></span><span style="color: #0000FF">(&nbsp;</span><span style="color: #335533">'plain'</span><span style="color: #0000FF">,&nbsp;</span><span style="color: #335533">'/tmp/cache/plain'</span><span style="color: #0000FF">,&nbsp;</span><span style="color: #335533">'<a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStorageFilePlain.html'>ezcCacheStorageFilePlain</a>'</span><span style="color: #0000FF">,&nbsp;</span><span style="color: #000000">$optionsPlain&nbsp;</span><span style="color: #0000FF">);</span></li>
<li><span style="color: #000000"><a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheManager.html#createCache'>ezcCacheManager::createCache</a></span><span style="color: #0000FF">(&nbsp;</span><span style="color: #335533">'array'</span><span style="color: #0000FF">,&nbsp;</span><span style="color: #335533">'/tmp/cache/array'</span><span style="color: #0000FF">,&nbsp;</span><span style="color: #335533">'<a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStorageFileArray.html'>ezcCacheStorageFileArray</a>'</span><span style="color: #0000FF">,&nbsp;</span><span style="color: #000000">$optionsArray&nbsp;</span><span style="color: #0000FF">);</span></li>
<li></li>
<li><span style="color: #000000">$myId&nbsp;</span><span style="color: #0000FF">=&nbsp;</span><span style="color: #335533">'unique_id_2'</span><span style="color: #0000FF">;</span></li>
<li></li>
<li><span style="color: #000000">$cache&nbsp;</span><span style="color: #0000FF">=&nbsp;</span><span style="color: #000000"><a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheManager.html#getCache'>ezcCacheManager::getCache</a></span><span style="color: #0000FF">(&nbsp;</span><span style="color: #335533">'plain'&nbsp;</span><span style="color: #0000FF">);</span></li>
<li></li>
<li><span style="color: #0000FF">if&nbsp;(&nbsp;(&nbsp;</span><span style="color: #000000">$plainData&nbsp;</span><span style="color: #0000FF">=&nbsp;</span><span style="color: #000000">$cache</span><span style="color: #0000FF">-&gt;</span><span style="color: #000000">restore</span><span style="color: #0000FF">(&nbsp;</span><span style="color: #000000">$myId&nbsp;</span><span style="color: #0000FF">)&nbsp;)&nbsp;===&nbsp;</span><span style="color: #000000">false&nbsp;</span><span style="color: #0000FF">)</span></li>
<li><span style="color: #0000FF">{</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000">$plainData&nbsp;</span><span style="color: #0000FF">=&nbsp;</span><span style="color: #335533">"Plain&nbsp;cache&nbsp;stored&nbsp;on&nbsp;"&nbsp;</span><span style="color: #0000FF">.&nbsp;</span><span style="color: #000000">date</span><span style="color: #0000FF">(&nbsp;</span><span style="color: #335533">'Y-m-d,&nbsp;H:m:s'&nbsp;</span><span style="color: #0000FF">);</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000">$cache</span><span style="color: #0000FF">-&gt;</span><span style="color: #000000">store</span><span style="color: #0000FF">(&nbsp;</span><span style="color: #000000">$myId</span><span style="color: #0000FF">,&nbsp;</span><span style="color: #000000">$plainData&nbsp;</span><span style="color: #0000FF">);</span></li>
<li></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000">sleep</span><span style="color: #0000FF">(&nbsp;</span><span style="color: #000000">2&nbsp;</span><span style="color: #0000FF">);</span></li>
<li><span style="color: #0000FF">}</span></li>
<li></li>
<li><span style="color: #0000FF">echo&nbsp;</span><span style="color: #335533">"Plain&nbsp;cache&nbsp;data:\n"</span><span style="color: #0000FF">;</span></li>
<li><span style="color: #000000">var_dump</span><span style="color: #0000FF">(&nbsp;</span><span style="color: #000000">$plainData&nbsp;</span><span style="color: #0000FF">);</span></li>
<li></li>
<li><span style="color: #000000">$cache&nbsp;</span><span style="color: #0000FF">=&nbsp;</span><span style="color: #000000"><a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheManager.html#getCache'>ezcCacheManager::getCache</a></span><span style="color: #0000FF">(&nbsp;</span><span style="color: #335533">'array'&nbsp;</span><span style="color: #0000FF">);</span></li>
<li></li>
<li><span style="color: #0000FF">if&nbsp;(&nbsp;(&nbsp;</span><span style="color: #000000">$arrayData&nbsp;</span><span style="color: #0000FF">=&nbsp;</span><span style="color: #000000">$cache</span><span style="color: #0000FF">-&gt;</span><span style="color: #000000">restore</span><span style="color: #0000FF">(&nbsp;</span><span style="color: #000000">$myId&nbsp;</span><span style="color: #0000FF">)&nbsp;)&nbsp;===&nbsp;</span><span style="color: #000000">false&nbsp;</span><span style="color: #0000FF">)</span></li>
<li><span style="color: #0000FF">{</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000">$arrayData&nbsp;</span><span style="color: #0000FF">=&nbsp;array(&nbsp;</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000">$plainData</span><span style="color: #0000FF">,</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #335533">"Array&nbsp;cache&nbsp;stored&nbsp;on&nbsp;"&nbsp;</span><span style="color: #0000FF">.&nbsp;</span><span style="color: #000000">date</span><span style="color: #0000FF">(&nbsp;</span><span style="color: #335533">'Y-m-d,&nbsp;H:m:s'</span><span style="color: #0000FF">),</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000">true</span><span style="color: #0000FF">,</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000">23</span></li>
<li><span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF">);</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000">$cache</span><span style="color: #0000FF">-&gt;</span><span style="color: #000000">store</span><span style="color: #0000FF">(&nbsp;</span><span style="color: #000000">$myId</span><span style="color: #0000FF">,&nbsp;</span><span style="color: #000000">$arrayData&nbsp;</span><span style="color: #0000FF">);</span></li>
<li><span style="color: #0000FF">}</span></li>
<li></li>
<li><span style="color: #0000FF">echo&nbsp;</span><span style="color: #335533">"Array&nbsp;cache&nbsp;data:\n"</span><span style="color: #0000FF">;</span></li>
<li><span style="color: #000000">var_dump</span><span style="color: #0000FF">(&nbsp;</span><span style="color: #000000">$arrayData&nbsp;</span><span style="color: #0000FF">);</span></li>
<li></li>
<li><span style="color: #000000">?&gt;</span></li>

</ol><p>In lines 12 and 13, two caches are created. Each <a href="#cache">cache</a> must reside in its own location and must have a different <a href="#cache-identifier">cache identifier</a>. We use two different options for the lifetime of the caches to show how they act independently.</p><p>Since the first <a href="#cache">cache</a> reuses the location already used in example 1, we use a different <a href="#cache-key">cache key</a> here. Lines 15 to 25 are almost identical to the code from example 1, except that the program will pause for two seconds when generating the plain cache, in order to show different generation times for the two caches.</p><p>On line 30, the second <a href="#cache">cache</a> object is retrieved, which is capable of storing arrays.  Therefore, we store the data from the plain cache here and generate some additional data to be stored in an array. Running this example multiple times will give you different results since the second cache has a longer lifetime and will therefore hold its data longer than the first one.</p><a name="complex-caching"></a><a name="id11"></a><h4>Complex caching</h4><p>As the next example shows, the <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStorage.html'>ezcCacheStorage</a> class is capable of more advanced features. This example uses extra attributes in addition to the <a href="#cache-key">cache key</a>:</p><ol class="code">
<li><span style="color: #000000">&lt;?php</span></li>
<li></li>
<li><span style="color: #0000FF">require_once&nbsp;</span><span style="color: #335533">'tutorial_autoload.php'</span><span style="color: #0000FF">;</span></li>
<li></li>
<li><span style="color: #000000">$options&nbsp;</span><span style="color: #0000FF">=&nbsp;array(</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #335533">'ttl'&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF">=&gt;&nbsp;</span><span style="color: #000000">30</span><span style="color: #0000FF">,</span></li>
<li><span style="color: #0000FF">);</span></li>
<li></li>
<li><span style="color: #000000"><a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheManager.html#createCache'>ezcCacheManager::createCache</a></span><span style="color: #0000FF">(&nbsp;</span><span style="color: #335533">'array'</span><span style="color: #0000FF">,&nbsp;</span><span style="color: #335533">'/tmp/cache/array'</span><span style="color: #0000FF">,&nbsp;</span><span style="color: #335533">'<a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStorageFileArray.html'>ezcCacheStorageFileArray</a>'</span><span style="color: #0000FF">,&nbsp;</span><span style="color: #000000">$options&nbsp;</span><span style="color: #0000FF">);</span></li>
<li></li>
<li><span style="color: #000000">$exampleData&nbsp;</span><span style="color: #0000FF">=&nbsp;array(&nbsp;</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #335533">'unique_id_3_a'&nbsp;</span><span style="color: #0000FF">=&gt;&nbsp;array(&nbsp;</span><span style="color: #335533">'language'&nbsp;</span><span style="color: #0000FF">=&gt;&nbsp;</span><span style="color: #335533">'en'</span><span style="color: #0000FF">,&nbsp;</span><span style="color: #335533">'section'&nbsp;</span><span style="color: #0000FF">=&gt;&nbsp;</span><span style="color: #335533">'articles'&nbsp;</span><span style="color: #0000FF">),</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #335533">'unique_id_3_b'&nbsp;</span><span style="color: #0000FF">=&gt;&nbsp;array(&nbsp;</span><span style="color: #335533">'language'&nbsp;</span><span style="color: #0000FF">=&gt;&nbsp;</span><span style="color: #335533">'de'</span><span style="color: #0000FF">,&nbsp;</span><span style="color: #335533">'section'&nbsp;</span><span style="color: #0000FF">=&gt;&nbsp;</span><span style="color: #335533">'articles'&nbsp;</span><span style="color: #0000FF">),</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #335533">'unique_id_3_c'&nbsp;</span><span style="color: #0000FF">=&gt;&nbsp;array(&nbsp;</span><span style="color: #335533">'language'&nbsp;</span><span style="color: #0000FF">=&gt;&nbsp;</span><span style="color: #335533">'no'</span><span style="color: #0000FF">,&nbsp;</span><span style="color: #335533">'section'&nbsp;</span><span style="color: #0000FF">=&gt;&nbsp;</span><span style="color: #335533">'articles'&nbsp;</span><span style="color: #0000FF">),</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #335533">'unique_id_3_d'&nbsp;</span><span style="color: #0000FF">=&gt;&nbsp;array(&nbsp;</span><span style="color: #335533">'language'&nbsp;</span><span style="color: #0000FF">=&gt;&nbsp;</span><span style="color: #335533">'de'</span><span style="color: #0000FF">,&nbsp;</span><span style="color: #335533">'section'&nbsp;</span><span style="color: #0000FF">=&gt;&nbsp;</span><span style="color: #335533">'tutorials'&nbsp;</span><span style="color: #0000FF">),</span></li>
<li><span style="color: #0000FF">);</span></li>
<li></li>
<li><span style="color: #000000">$cache&nbsp;</span><span style="color: #0000FF">=&nbsp;</span><span style="color: #000000"><a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheManager.html#getCache'>ezcCacheManager::getCache</a></span><span style="color: #0000FF">(&nbsp;</span><span style="color: #335533">'array'&nbsp;</span><span style="color: #0000FF">);</span></li>
<li></li>
<li><span style="color: #0000FF">foreach&nbsp;(&nbsp;</span><span style="color: #000000">$exampleData&nbsp;</span><span style="color: #0000FF">as&nbsp;</span><span style="color: #000000">$myId&nbsp;</span><span style="color: #0000FF">=&gt;&nbsp;</span><span style="color: #000000">$exampleDataArr&nbsp;</span><span style="color: #0000FF">)</span></li>
<li><span style="color: #0000FF">{</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;(&nbsp;</span><span style="color: #000000">$data&nbsp;</span><span style="color: #0000FF">=&nbsp;</span><span style="color: #000000">$cache</span><span style="color: #0000FF">-&gt;</span><span style="color: #000000">restore</span><span style="color: #0000FF">(&nbsp;</span><span style="color: #000000">$myId</span><span style="color: #0000FF">,&nbsp;</span><span style="color: #000000">$exampleDataArr&nbsp;</span><span style="color: #0000FF">)&nbsp;)&nbsp;===&nbsp;</span><span style="color: #000000">false&nbsp;</span><span style="color: #0000FF">)</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;{</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000">$cache</span><span style="color: #0000FF">-&gt;</span><span style="color: #000000">store</span><span style="color: #0000FF">(&nbsp;</span><span style="color: #000000">$myId</span><span style="color: #0000FF">,&nbsp;</span><span style="color: #000000">$exampleDataArr</span><span style="color: #0000FF">,&nbsp;</span><span style="color: #000000">$exampleDataArr&nbsp;</span><span style="color: #0000FF">);</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;}</span></li>
<li><span style="color: #0000FF">}</span></li>
<li></li>
<li><span style="color: #0000FF">echo&nbsp;</span><span style="color: #335533">"Data&nbsp;items&nbsp;with&nbsp;attribute&nbsp;&lt;section&gt;&nbsp;set&nbsp;to&nbsp;&lt;articles&gt;:&nbsp;"&nbsp;</span><span style="color: #0000FF">.</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000">$cache</span><span style="color: #0000FF">-&gt;</span><span style="color: #000000">countDataItems</span><span style="color: #0000FF">(&nbsp;</span><span style="color: #000000">null</span><span style="color: #0000FF">,&nbsp;array(&nbsp;</span><span style="color: #335533">'section'&nbsp;</span><span style="color: #0000FF">=&gt;&nbsp;</span><span style="color: #335533">'articles'&nbsp;</span><span style="color: #0000FF">)&nbsp;)&nbsp;.</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #335533">"\n"</span><span style="color: #0000FF">;</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li>
<li><span style="color: #0000FF">echo&nbsp;</span><span style="color: #335533">"Data&nbsp;items&nbsp;with&nbsp;attribute&nbsp;&lt;language&gt;&nbsp;set&nbsp;to&nbsp;&lt;de&gt;:&nbsp;"&nbsp;</span><span style="color: #0000FF">.</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000">$cache</span><span style="color: #0000FF">-&gt;</span><span style="color: #000000">countDataItems</span><span style="color: #0000FF">(&nbsp;</span><span style="color: #000000">null</span><span style="color: #0000FF">,&nbsp;array(&nbsp;</span><span style="color: #335533">'language'&nbsp;</span><span style="color: #0000FF">=&gt;&nbsp;</span><span style="color: #335533">'de'&nbsp;</span><span style="color: #0000FF">)&nbsp;)&nbsp;.</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #335533">"\n\n"</span><span style="color: #0000FF">;</span></li>
<li></li>
<li><span style="color: #000000">$cache</span><span style="color: #0000FF">-&gt;</span><span style="color: #000000">delete</span><span style="color: #0000FF">(&nbsp;</span><span style="color: #000000">null</span><span style="color: #0000FF">,&nbsp;array(&nbsp;</span><span style="color: #335533">'language'&nbsp;</span><span style="color: #0000FF">=&gt;&nbsp;</span><span style="color: #335533">'de'&nbsp;</span><span style="color: #0000FF">)&nbsp;);</span></li>
<li></li>
<li><span style="color: #0000FF">echo&nbsp;</span><span style="color: #335533">"Data&nbsp;items&nbsp;with&nbsp;attribute&nbsp;&lt;section&gt;&nbsp;set&nbsp;to&nbsp;&lt;articles&gt;:&nbsp;"&nbsp;</span><span style="color: #0000FF">.</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000">$cache</span><span style="color: #0000FF">-&gt;</span><span style="color: #000000">countDataItems</span><span style="color: #0000FF">(&nbsp;</span><span style="color: #000000">null</span><span style="color: #0000FF">,&nbsp;array(&nbsp;</span><span style="color: #335533">'section'&nbsp;</span><span style="color: #0000FF">=&gt;&nbsp;</span><span style="color: #335533">'articles'&nbsp;</span><span style="color: #0000FF">)&nbsp;)&nbsp;.</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #335533">"\n"</span><span style="color: #0000FF">;</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li>
<li><span style="color: #0000FF">echo&nbsp;</span><span style="color: #335533">"Data&nbsp;items&nbsp;with&nbsp;attribute&nbsp;&lt;language&gt;&nbsp;set&nbsp;to&nbsp;&lt;de&gt;:&nbsp;"&nbsp;</span><span style="color: #0000FF">.</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000">$cache</span><span style="color: #0000FF">-&gt;</span><span style="color: #000000">countDataItems</span><span style="color: #0000FF">(&nbsp;</span><span style="color: #000000">null</span><span style="color: #0000FF">,&nbsp;array(&nbsp;</span><span style="color: #335533">'language'&nbsp;</span><span style="color: #0000FF">=&gt;&nbsp;</span><span style="color: #335533">'de'&nbsp;</span><span style="color: #0000FF">)&nbsp;)&nbsp;.</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #335533">"\n\n"</span><span style="color: #0000FF">;</span></li>
<li></li>
<li><span style="color: #000000">?&gt;</span></li>

</ol><p>After the creation of an array <a href="#cache">cache</a>, some sample data is created (lines 11-16). Data is identified by <a href="#cache-key">cache key</a> s, which are associated with arrays. Each array will be used to store the content and the attributes together. <a href="#attribute">Attribute</a> s describe a <a href="#cache-item">cache item</a> s in further detail.</p><p>In line 20, a foreach loop starts, which stores all example data in the cache. After that, the method <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStorageFile.html#countDataItems'>ezcCacheStorageFile::countDataItems</a>() is used to count cache items that meet certain criteria. The first parameter here would be a <a href="#cache-key">cache key</a>. When this is set, the method should always return 1 or 0, because only one cache item per <a href="#cache-key">cache key</a> may exist. In this example, the cache items with the specified attribute are counted. The attributes to match are supplied as the second parameter. The first method call will return 3 (line 28), since we have three cache items that have the attribute "section" set to "articles". The second call (line 32) should return 2, because two data items have the attribute "language" set to the value "de".</p><p>On line 36 the storage object is told to delete all cache items that have the <a href="#attribute">attribute</a> "language" set to "de". Therefore, the next calls to <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStorageFile.html#countDataItems'>ezcCacheStorageFile::countDataItems</a>() will return 2 and 0.</p><a name="memory-caching"></a><a name="id12"></a><h4>Memory caching</h4><p>If either of <a href="http://pecl.php.net/package/Memcache">Memcache</a> or <a href="http://pecl.php.net/package/APC">APC</a> PHP extensions is installed, then the caching performance can be improved considerably by storing the cache data in memory between requests.</p><a name="id2"></a><a name="id13"></a><h5>APC</h5><p>To use the APC cache storage, the <a href="http://pecl.php.net/package/APC">APC</a> PHP extension must be installed. The corresponding storage class is <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStorageApcPlain.html'>ezcCacheStorageApcPlain</a>. Note, that the other existing APC storage class, <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStorageFileApcArray.html'>ezcCacheStorageFileApcArray</a> has been deprecated in favor of hierarchical caching provided by <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStack.html'>ezcCacheStack</a>. It is not recommended to use this class further on, since it will be removed in the next major version of the Cache component.</p><p>The following example shows how to create and use a plain APC storage. It is the same as the simple example above, but using the <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStorageApcPlain.html'>ezcCacheStorageApcPlain</a> class instead of <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStorageFilePlain.html'>ezcCacheStorageFilePlain</a>. The second parameter of the createCache() method is arbitrary, because an existing path is not needed. However, the $location ensures the uniqueness of a cache storage in the manager. Therefore this parameter should be used accordingly.</p><ol class="code">
<li><span style="color: #000000">&lt;?php</span></li>
<li></li>
<li><span style="color: #0000FF">require_once&nbsp;</span><span style="color: #335533">'tutorial_autoload.php'</span><span style="color: #0000FF">;</span></li>
<li></li>
<li><span style="color: #000000">$options&nbsp;</span><span style="color: #0000FF">=&nbsp;array(</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #335533">'ttl'&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF">=&gt;&nbsp;</span><span style="color: #000000">30</span><span style="color: #0000FF">,</span></li>
<li><span style="color: #0000FF">);</span></li>
<li></li>
<li><span style="color: #000000"><a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheManager.html#createCache'>ezcCacheManager::createCache</a></span><span style="color: #0000FF">(&nbsp;</span><span style="color: #335533">'apc'</span><span style="color: #0000FF">,&nbsp;</span><span style="color: #335533">'apc'</span><span style="color: #0000FF">,&nbsp;</span><span style="color: #335533">'<a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStorageApcPlain.html'>ezcCacheStorageApcPlain</a>'</span><span style="color: #0000FF">,&nbsp;</span><span style="color: #000000">$options&nbsp;</span><span style="color: #0000FF">);</span></li>
<li></li>
<li><span style="color: #000000">$myId&nbsp;</span><span style="color: #0000FF">=&nbsp;</span><span style="color: #335533">'unique_id_1'</span><span style="color: #0000FF">;</span></li>
<li><span style="color: #000000">$mySecondId&nbsp;</span><span style="color: #0000FF">=&nbsp;</span><span style="color: #335533">'id_2'</span><span style="color: #0000FF">;</span></li>
<li></li>
<li><span style="color: #000000">$cache&nbsp;</span><span style="color: #0000FF">=&nbsp;</span><span style="color: #000000"><a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheManager.html#getCache'>ezcCacheManager::getCache</a></span><span style="color: #0000FF">(&nbsp;</span><span style="color: #335533">'apc'&nbsp;</span><span style="color: #0000FF">);</span></li>
<li></li>
<li><span style="color: #0000FF">if&nbsp;(&nbsp;(&nbsp;</span><span style="color: #000000">$dataOfFirstItem&nbsp;</span><span style="color: #0000FF">=&nbsp;</span><span style="color: #000000">$cache</span><span style="color: #0000FF">-&gt;</span><span style="color: #000000">restore</span><span style="color: #0000FF">(&nbsp;</span><span style="color: #000000">$myId&nbsp;</span><span style="color: #0000FF">)&nbsp;)&nbsp;===&nbsp;</span><span style="color: #000000">false&nbsp;</span><span style="color: #0000FF">)</span></li>
<li><span style="color: #0000FF">{</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000">$dataOfFirstItem&nbsp;</span><span style="color: #0000FF">=&nbsp;</span><span style="color: #335533">"Plain&nbsp;cache&nbsp;stored&nbsp;on&nbsp;"&nbsp;</span><span style="color: #0000FF">.&nbsp;</span><span style="color: #000000">date</span><span style="color: #0000FF">(&nbsp;</span><span style="color: #335533">'Y-m-d,&nbsp;H:i:s'&nbsp;</span><span style="color: #0000FF">);</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000">$cache</span><span style="color: #0000FF">-&gt;</span><span style="color: #000000">store</span><span style="color: #0000FF">(&nbsp;</span><span style="color: #000000">$myId</span><span style="color: #0000FF">,&nbsp;</span><span style="color: #000000">$dataOfFirstItem&nbsp;</span><span style="color: #0000FF">);</span></li>
<li><span style="color: #0000FF">}</span></li>
<li></li>
<li><span style="color: #0000FF">if&nbsp;(&nbsp;(&nbsp;</span><span style="color: #000000">$dataOfSecondItem&nbsp;</span><span style="color: #0000FF">=&nbsp;</span><span style="color: #000000">$cache</span><span style="color: #0000FF">-&gt;</span><span style="color: #000000">restore</span><span style="color: #0000FF">(&nbsp;</span><span style="color: #000000">$mySecondId&nbsp;</span><span style="color: #0000FF">)&nbsp;)&nbsp;===&nbsp;</span><span style="color: #000000">false&nbsp;</span><span style="color: #0000FF">)</span></li>
<li><span style="color: #0000FF">{</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000">$dataOfSecondItem&nbsp;</span><span style="color: #0000FF">=&nbsp;</span><span style="color: #335533">"Plain&nbsp;cache&nbsp;2&nbsp;stored&nbsp;on&nbsp;"&nbsp;</span><span style="color: #0000FF">.&nbsp;</span><span style="color: #000000">date</span><span style="color: #0000FF">(&nbsp;</span><span style="color: #335533">'Y-m-d,&nbsp;H:i:s'&nbsp;</span><span style="color: #0000FF">);</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000">$cache</span><span style="color: #0000FF">-&gt;</span><span style="color: #000000">store</span><span style="color: #0000FF">(&nbsp;</span><span style="color: #000000">$mySecondId</span><span style="color: #0000FF">,&nbsp;</span><span style="color: #000000">$dataOfSecondItem&nbsp;</span><span style="color: #0000FF">);</span></li>
<li><span style="color: #0000FF">}</span></li>
<li></li>
<li><span style="color: #000000">var_dump</span><span style="color: #0000FF">(&nbsp;</span><span style="color: #000000">$dataOfFirstItem</span><span style="color: #0000FF">,&nbsp;</span><span style="color: #000000">$dataOfSecondItem&nbsp;</span><span style="color: #0000FF">);</span></li>
<li></li>
<li><span style="color: #000000">?&gt;</span></li>

</ol><a name="id3"></a><a name="id14"></a><h5>Memcache</h5><p>Certain options must be set before creating a Memcache cache storage. Changing these options after the storage has been created does not affect the object in any way, since the connection to the Memcache is established in the constructor.</p><dl><dt>host</dt><dd>The name of the host running Memcache. The default is 'localhost'.</dd><dt>port</dt><dd>The port on which to connect to the Memcache host. The default is 11211.</dd><dt>persistent</dt><dd>Determines if the connection to the Memcache server should be persistent. A persistent connection does not close when the script ends. By default this is false.</dd><dt>compressed</dt><dd>If the data is to be compressed in the cache. The zlib extension is required, if this option is set to true. False is the default.</dd></dl><p>The following example shows how to create and use a plain Memcache storage. It is the same as the simple example above, but using the <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStorageMemcachePlain.html'>ezcCacheStorageMemcachePlain</a> class instead of <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStorageFilePlain.html'>ezcCacheStorageFilePlain</a>. The second parameter of the createCache() method is chosen arbitrary, because an existing path is not needed. However, the $location parameter takes care for the uniqueness of the storage in the manager. The $host an $port options just reflect the defaul here, they could also have been left out.</p><ol class="code">
<li><span style="color: #000000">&lt;?php</span></li>
<li></li>
<li><span style="color: #0000FF">require_once&nbsp;</span><span style="color: #335533">'tutorial_autoload.php'</span><span style="color: #0000FF">;</span></li>
<li></li>
<li><span style="color: #000000">$options&nbsp;</span><span style="color: #0000FF">=&nbsp;array(</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #335533">'ttl'&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF">=&gt;&nbsp;</span><span style="color: #000000">30</span><span style="color: #0000FF">,</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #335533">'host'&nbsp;&nbsp;</span><span style="color: #0000FF">=&gt;&nbsp;</span><span style="color: #335533">'localhost'</span><span style="color: #0000FF">,</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #335533">'port'&nbsp;&nbsp;</span><span style="color: #0000FF">=&gt;&nbsp;</span><span style="color: #000000">11211</span></li>
<li><span style="color: #0000FF">);</span></li>
<li></li>
<li><span style="color: #000000"><a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheManager.html#createCache'>ezcCacheManager::createCache</a></span><span style="color: #0000FF">(&nbsp;</span><span style="color: #335533">'memcache'</span><span style="color: #0000FF">,&nbsp;</span><span style="color: #335533">'memcache'</span><span style="color: #0000FF">,&nbsp;</span><span style="color: #335533">'<a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStorageMemcachePlain.html'>ezcCacheStorageMemcachePlain</a>'</span><span style="color: #0000FF">,&nbsp;</span><span style="color: #000000">$options&nbsp;</span><span style="color: #0000FF">);</span></li>
<li></li>
<li><span style="color: #000000">$myId&nbsp;</span><span style="color: #0000FF">=&nbsp;</span><span style="color: #335533">'unique_id_1'</span><span style="color: #0000FF">;</span></li>
<li><span style="color: #000000">$mySecondId&nbsp;</span><span style="color: #0000FF">=&nbsp;</span><span style="color: #335533">'id_2'</span><span style="color: #0000FF">;</span></li>
<li></li>
<li><span style="color: #000000">$cache&nbsp;</span><span style="color: #0000FF">=&nbsp;</span><span style="color: #000000"><a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheManager.html#getCache'>ezcCacheManager::getCache</a></span><span style="color: #0000FF">(&nbsp;</span><span style="color: #335533">'memcache'&nbsp;</span><span style="color: #0000FF">);</span></li>
<li></li>
<li><span style="color: #0000FF">if&nbsp;(&nbsp;(&nbsp;</span><span style="color: #000000">$dataOfFirstItem&nbsp;</span><span style="color: #0000FF">=&nbsp;</span><span style="color: #000000">$cache</span><span style="color: #0000FF">-&gt;</span><span style="color: #000000">restore</span><span style="color: #0000FF">(&nbsp;</span><span style="color: #000000">$myId&nbsp;</span><span style="color: #0000FF">)&nbsp;)&nbsp;===&nbsp;</span><span style="color: #000000">false&nbsp;</span><span style="color: #0000FF">)</span></li>
<li><span style="color: #0000FF">{</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000">$dataOfFirstItem&nbsp;</span><span style="color: #0000FF">=&nbsp;</span><span style="color: #335533">"Plain&nbsp;cache&nbsp;stored&nbsp;on&nbsp;"&nbsp;</span><span style="color: #0000FF">.&nbsp;</span><span style="color: #000000">date</span><span style="color: #0000FF">(&nbsp;</span><span style="color: #335533">'Y-m-d,&nbsp;H:i:s'&nbsp;</span><span style="color: #0000FF">);</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000">$cache</span><span style="color: #0000FF">-&gt;</span><span style="color: #000000">store</span><span style="color: #0000FF">(&nbsp;</span><span style="color: #000000">$myId</span><span style="color: #0000FF">,&nbsp;</span><span style="color: #000000">$dataOfFirstItem&nbsp;</span><span style="color: #0000FF">);</span></li>
<li><span style="color: #0000FF">}</span></li>
<li></li>
<li><span style="color: #0000FF">if&nbsp;(&nbsp;(&nbsp;</span><span style="color: #000000">$dataOfSecondItem&nbsp;</span><span style="color: #0000FF">=&nbsp;</span><span style="color: #000000">$cache</span><span style="color: #0000FF">-&gt;</span><span style="color: #000000">restore</span><span style="color: #0000FF">(&nbsp;</span><span style="color: #000000">$mySecondId&nbsp;</span><span style="color: #0000FF">)&nbsp;)&nbsp;===&nbsp;</span><span style="color: #000000">false&nbsp;</span><span style="color: #0000FF">)</span></li>
<li><span style="color: #0000FF">{</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000">$dataOfSecondItem&nbsp;</span><span style="color: #0000FF">=&nbsp;</span><span style="color: #335533">"Plain&nbsp;cache&nbsp;2&nbsp;stored&nbsp;on&nbsp;"&nbsp;</span><span style="color: #0000FF">.&nbsp;</span><span style="color: #000000">date</span><span style="color: #0000FF">(&nbsp;</span><span style="color: #335533">'Y-m-d,&nbsp;H:i:s'&nbsp;</span><span style="color: #0000FF">);</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000">$cache</span><span style="color: #0000FF">-&gt;</span><span style="color: #000000">store</span><span style="color: #0000FF">(&nbsp;</span><span style="color: #000000">$mySecondId</span><span style="color: #0000FF">,&nbsp;</span><span style="color: #000000">$dataOfSecondItem&nbsp;</span><span style="color: #0000FF">);</span></li>
<li><span style="color: #0000FF">}</span></li>
<li></li>
<li><span style="color: #000000">var_dump</span><span style="color: #0000FF">(&nbsp;</span><span style="color: #000000">$dataOfFirstItem</span><span style="color: #0000FF">,&nbsp;</span><span style="color: #000000">$dataOfSecondItem&nbsp;</span><span style="color: #0000FF">);</span></li>
<li></li>
<li><span style="color: #000000">?&gt;</span></li>

</ol><a name="hierarchical-caching"></a><a name="id15"></a><h4>Hierarchical caching</h4><p>The <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStack.html'>ezcCacheStack</a> class allows you to build a stack of arbitrary cache storages that implement <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStackable.html'>ezcCacheStackable</a> storage. This stack allows you to combine very fast caches (like APC and Memcache), which are mostly small, with slower ones, that are usually quite large. Similar techniques are used in CPU caches and file system caches.</p><p>Whenever data is stored in a cache stack, it is stored in all of the stacked storages. For each of the storages, an $itemLimit is configured that determines how many items may reside in a cache. If this limit is reached for a storage during the store operation of a new item, a certain amount of items is removed from that storage to free up space. The fraction of $itemLimit that is freed when reaching the limit is the $freeRate of the storage.</p><a name="a-simple-stack"></a><a name="id16"></a><h5>A simple stack</h5><p>The following example shows how 2 caches are combined to a stack. Assume that $storageApc contains an instance of <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStorageApcPlain.html'>ezcCacheStorageApcPlain</a> and $storageFile contains an instance of <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStorageFileArray.html'>ezcCacheStorageFileArray</a>.</p><ol class="code">
<li><span style="color: #000000">&lt;?php</span></li>
<li></li>
<li><span style="color: #0000FF">require_once&nbsp;</span><span style="color: #335533">'tutorial_autoload.php'</span><span style="color: #0000FF">;</span></li>
<li></li>
<li><span style="color: #000000">$stack&nbsp;</span><span style="color: #0000FF">=&nbsp;new&nbsp;</span><span style="color: #000000"><a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStack.html'>ezcCacheStack</a></span><span style="color: #0000FF">(&nbsp;</span><span style="color: #335533">'stack'&nbsp;</span><span style="color: #0000FF">);</span></li>
<li></li>
<li><span style="color: #000000">$stack</span><span style="color: #0000FF">-&gt;</span><span style="color: #000000">pushStorage</span><span style="color: #0000FF">(</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;</span><span style="color: #000000"><a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStackStorageConfiguration.html'>ezcCacheStackStorageConfiguration</a></span><span style="color: #0000FF">(</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #335533">'file'</span><span style="color: #0000FF">,</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000">$fileStorage</span><span style="color: #0000FF">,</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000">1000000</span><span style="color: #0000FF">,</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000">.5</span></li>
<li><span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF">)</span></li>
<li><span style="color: #0000FF">);</span></li>
<li><span style="color: #000000">$stack</span><span style="color: #0000FF">-&gt;</span><span style="color: #000000">pushStorage</span><span style="color: #0000FF">(</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;</span><span style="color: #000000"><a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStackStorageConfiguration.html'>ezcCacheStackStorageConfiguration</a></span><span style="color: #0000FF">(</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #335533">'apc'</span><span style="color: #0000FF">,</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000">$apcStorage</span><span style="color: #0000FF">,</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000">1000</span><span style="color: #0000FF">,</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000">.3</span></li>
<li><span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF">)</span></li>
<li><span style="color: #0000FF">);</span></li>
<li></li>
<li><span style="color: #000000">$stack</span><span style="color: #0000FF">-&gt;</span><span style="color: #000000">options</span><span style="color: #0000FF">-&gt;</span><span style="color: #000000">replacementStrategy&nbsp;</span><span style="color: #0000FF">=&nbsp;</span><span style="color: #335533">'<a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStackLfuReplacementStrategy.html'>ezcCacheStackLfuReplacementStrategy</a>'</span><span style="color: #0000FF">;</span></li>
<li></li>
<li><span style="color: #007700">//&nbsp;...&nbsp;somewhere&nbsp;else...</span></li>
<li></li>
<li><span style="color: #000000">$stack</span><span style="color: #0000FF">-&gt;</span><span style="color: #000000">store</span><span style="color: #0000FF">(</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #335533">'id_1'</span><span style="color: #0000FF">,&nbsp;</span><span style="color: #335533">'id_1_data'</span></li>
<li><span style="color: #0000FF">);</span></li>
<li><span style="color: #000000">$stack</span><span style="color: #0000FF">-&gt;</span><span style="color: #000000">store</span><span style="color: #0000FF">(</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #335533">'id_2'</span><span style="color: #0000FF">,&nbsp;</span><span style="color: #335533">'id_2_data'</span><span style="color: #0000FF">,&nbsp;array(&nbsp;</span><span style="color: #335533">'attribute'&nbsp;</span><span style="color: #0000FF">=&gt;&nbsp;</span><span style="color: #335533">'value'&nbsp;</span><span style="color: #0000FF">)</span></li>
<li><span style="color: #0000FF">);</span></li>
<li><span style="color: #000000">$id1data&nbsp;</span><span style="color: #0000FF">=&nbsp;</span><span style="color: #000000">$stack</span><span style="color: #0000FF">-&gt;</span><span style="color: #000000">restore</span><span style="color: #0000FF">(&nbsp;</span><span style="color: #335533">'id_1'&nbsp;</span><span style="color: #0000FF">);</span></li>
<li></li>
<li><span style="color: #000000">?&gt;</span></li>

</ol><p>The <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStack.html'>ezcCacheStack</a> class (which is itself a descendant of <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStorage.html'>ezcCacheStorage</a>) is initialized with an arbitrary location string. This string is actually not used, since a stack does not need a dedicated location. However, the <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheManager.html'>ezcCacheManager</a> needs this identifier for sanity checks, so it should be a sensible key.</p><p>The method <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStack.html#push'>ezcCacheStack-&gt;push</a>() adds a new <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStackableStorage.html'>ezcCacheStackableStorage</a> to the stack. Therefore, the $fileStorage resides on the very bottom of the stack and the APC storage is at the top. All implementations of <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStorage.html'>ezcCacheStorage</a> inside the Cache component also implement <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStackableStoragel.html'>ezcCacheStackableStoragel</a>, so you can stack all of them. To ease the internal handling of the storage configurations, the <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStackStorageConfiguration.html'>ezcCacheStackStorageConfiguration</a> class is used. In addition, objects of this type perform sanity checks on their parameters.</p><p>The first parameter to the constructor of a storage configuration is an identifier which identifies the storage uniquely inside a stack. If you make consequent use of <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheManager.html'>ezcCacheManager</a> and the $location parameter of each storage, you should use the <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStorage.html'>ezcCacheStorage</a>-&gt;$location here, since it is already unique over all storages. Remember, that you never change the identifier of the storage in the stack between requests, without calling <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStack.html#reset'>ezcCacheStack-&gt;reset</a>(). This will considerably harm your stored data and produce unpredictable behavior of the stack.</p><p>The third parameter to <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStackStorageConfiguration.html#__construct'>ezcCacheStackStorageConfiguration-&gt;__construct</a>() is the item limit for that storage. In this sense, $fileStorage may contain up to a million items, while $apcStorage may only contain 1,000. The last parameter is the $freeRate assigned to the storage. If the $fileStorage reaches 1,000,000 items, 500,000 of them will be freed. For the APC storage, only 300 items will be removed when the item limit is reached.</p><p>For the freeing of items, the cache stack first purges all outdated items from the affected storage using <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStackableStorage.html#purge'>ezcCacheStackableStorage-&gt;purge</a>(). If this does not remove the desired number of items, a special replacement strategy is utilized to free up more items. In the example above, the replacement strategy <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStackLfuReplacementStrategy.html'>ezcCacheStackLfuReplacementStrategy</a> (<em>LRU</em> = Least Frequently Used) is chosen. This strategy will record every access (store/restore) to a cache item and will purge those first, which have been least frequently accessed. The default replacement strategy is <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStackLruReplacementStrategy.html'>ezcCacheStackLruReplacementStrategy</a> (<em>LRU</em> = Least Recently Used), which removes such items first, that have been accessed least recently.</p><p>Usually, the faster caches will run full first in will therefore be purged first. The result is, that these caches contain the "most important" (depending on the replacement strategy) items. Items which are not used that much will be purged from fast caches soon and will only be stored in the slower caches. The stack will always restore an item from the storage in which it is found first.</p><p>As you have seen in the above example, storing and restoring with caches works exactly like with other cache storages.</p><a name="stacks-and-ezccachemanager"></a><a name="id17"></a><h5>Stacks and <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheManager.html'>ezcCacheManager</a></h5><p>The <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheManager.html'>ezcCacheManager</a> is used to lazy initialize cache objects when they are first needed in your application and to make caches globally available. On a first glance this does not work with <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStack.html'>ezcCacheStack</a>, since ready to use <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStackableStorages.html'>ezcCacheStackableStorages</a> are needed for its configuration. To allow lazy initialization, a class that implements <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStackConfigurator.html'>ezcCacheStackConfigurator</a> can be used.</p><ol class="code">
<li><span style="color: #000000">&lt;?php</span></li>
<li></li>
<li><span style="color: #0000FF">require_once&nbsp;</span><span style="color: #335533">'tutorial_autoload.php'</span><span style="color: #0000FF">;</span></li>
<li></li>
<li><span style="color: #0000FF">class&nbsp;</span><span style="color: #000000">myCustomConfigurator&nbsp;</span><span style="color: #0000FF">implements&nbsp;</span><span style="color: #000000">ezcCacheStackConfigurator</span></li>
<li><span style="color: #0000FF">{</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;</span><span style="color: #000000">configure</span><span style="color: #0000FF">(&nbsp;</span><span style="color: #000000">ezcCacheStack&nbsp;$stack&nbsp;</span><span style="color: #0000FF">)</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;{</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">//&nbsp;...&nbsp;create&nbsp;your&nbsp;storages&nbsp;here&nbsp;or&nbsp;fetch&nbsp;from&nbsp;manager...</span></li>
<li><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000">$stack</span><span style="color: #0000FF">-&gt;</span><span style="color: #000000">pushStorage</span><span style="color: #0000FF">(</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;</span><span style="color: #000000"><a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStackStorageConfiguration.html'>ezcCacheStackStorageConfiguration</a></span><span style="color: #0000FF">(</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #335533">'file'</span><span style="color: #0000FF">,</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000">$fileStorage</span><span style="color: #0000FF">,</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000">1000000</span><span style="color: #0000FF">,</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000">.5</span></li>
<li><span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF">)</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000">$stack</span><span style="color: #0000FF">-&gt;</span><span style="color: #000000">pushStorage</span><span style="color: #0000FF">(</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;</span><span style="color: #000000"><a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStackStorageConfiguration.html'>ezcCacheStackStorageConfiguration</a></span><span style="color: #0000FF">(</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #335533">'apc'</span><span style="color: #0000FF">,</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000">$apcStorage</span><span style="color: #0000FF">,</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000">1000</span><span style="color: #0000FF">,</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000">.3</span></li>
<li><span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF">)</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;}</span></li>
<li><span style="color: #0000FF">}</span></li>
<li></li>
<li><span style="color: #000000">$stackOptions&nbsp;</span><span style="color: #0000FF">=&nbsp;array(</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #335533">'bubbleUpOnRestore'&nbsp;</span><span style="color: #0000FF">=&gt;&nbsp;</span><span style="color: #000000">true</span><span style="color: #0000FF">,</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #335533">'configurator'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF">=&gt;&nbsp;</span><span style="color: #335533">'myCustomConfigurator'</span><span style="color: #0000FF">,</span></li>
<li><span style="color: #0000FF">);</span></li>
<li></li>
<li><span style="color: #000000">$stack&nbsp;</span><span style="color: #0000FF">=&nbsp;new&nbsp;</span><span style="color: #000000"><a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStack.html'>ezcCacheStack</a></span><span style="color: #0000FF">(&nbsp;</span><span style="color: #335533">'stack'&nbsp;</span><span style="color: #0000FF">);</span></li>
<li><span style="color: #000000"><a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheManager.html#createCache'>ezcCacheManager::createCache</a></span><span style="color: #0000FF">(</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #335533">'stack'</span><span style="color: #0000FF">,</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #335533">'stack'</span><span style="color: #0000FF">,</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #335533">'<a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStack.html'>ezcCacheStack</a>'</span><span style="color: #0000FF">,</span></li>
<li><span style="color: #0000FF">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000">$stackOptions</span></li>
<li><span style="color: #0000FF">);</span></li>
<li></li>
<li><span style="color: #007700">//&nbsp;...&nbsp;somewhere&nbsp;else...</span></li>
<li></li>
<li><span style="color: #000000">$stack&nbsp;</span><span style="color: #0000FF">=&nbsp;</span><span style="color: #000000"><a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheManager.html#getCache'>ezcCacheManager::getCache</a></span><span style="color: #0000FF">(&nbsp;</span><span style="color: #335533">'stack'&nbsp;</span><span style="color: #0000FF">);</span></li>
<li></li>
<li><span style="color: #000000">?&gt;</span></li>

</ol><p>This example configures a similar stack than the previous one. Instead of doing so directly, a new class myCustomConfigurator is created which extends <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStackConfigurator.html'>ezcCacheStackConfigurator</a>. The static configure() method is defined by this interface and creates the storages (or receives them from the manager) to add them to the given stack.</p><p>The class is configured to be used as the $configurator through the options array that is given to <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheManager.html#createCache'>ezcCacheManager-&gt;createCache</a>(). The speciality about this option is, that it is only used once: During the actual construction of the stack, when it is first requested from the manager. In this case, <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStack.html#__construct'>ezcCacheStack::__construct</a>() calls myCustomConfigurator::configure() and submits the fresh created stack instance to it.</p><p>Another option is shown in this example: $bubbleUpOnRestore. If this option is set, every item that is restored from a lower level storage will be stored in the caches above it again. While this sounds sensible at a first glance, it has some fundamental draw backs:</p><ul><li><p>The "bubble up" process might again result in other items being purged from upper storages. This can make restoring much slower.</p></li><li><p>The restored item is only stored with the attributes assigned which have been used for restoring it. If more attributes were assigned to that item, these are lost in the upper storages.</p></li><li><p>The time to live (TTL) of the item will be re-newed for the upper storages.</p></li></ul><a name="stack-meta-data"></a><a name="id18"></a><h5>Stack meta data</h5><p>An <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStack.html'>ezcCacheStack</a> instance needs to store certain meta data, which is actually related to the used replacement strategy. The meta data is quite sensitive and depends heavily on the layout of your stack. Therefore you must always perform a <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStack.html#reset'>ezcCacheStack-&gt;reset</a>() in case you change the layout of your stack. This will clean up all data from the storages in the stack and also clean up the meta data. Remember that you also reset a storage that has been removed from a stack, before using it with another one, since it might have meta data stored.</p><p>The meta data used by a stack is stored in one of the storages inside it. If not configured otherwise, the top most storage is chosen for this, since it is usually the fastest one. However cases exist where the top most storage is not suitable as the meta data storage. These are:</p><ul><li><p>If you implemented your own storage which does not implement <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheMetaDataStorage.html'>ezcCacheMetaDataStorage</a>.</p></li><li><p>If the top most storage is only local to the current request or server, but the environment is distributed on several servers.</p></li></ul><p>In both cases you can configure the meta data storage manually, using the $metaStorage property of <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStackOptions.html'>ezcCacheStackOptions</a>, which must contain an object implementing the <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheMetaDataStorage.html'>ezcCacheMetaDataStorage</a> interface.</p><a name="more-information"></a><a name="id19"></a><h3>More Information</h3><p>For more information, see the <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheManager.html'>ezcCacheManager</a>, <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStorageFile.html'>ezcCacheStorageFile</a>, <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStorageMemory.html'>ezcCacheStorageMemory</a> and <a href='/zetacomponents/documentation/trunk/Cache/phpdoc/ezcCacheStack.html'>ezcCacheStack</a> API documentation.</p><!--Local Variables:
mode: rst
fill-column: 79
End:
vim: et syn=rst tw=79-->

	</div>

	<div class="footer">
	Copyright  2010 <a href="http://apache.org">The Software Foundation</a>
</div>
</div>
</body>
</html>
